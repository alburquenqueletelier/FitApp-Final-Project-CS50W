# CaliRoad

CaliRoad is a non-profit application that seeks to generate a database of calisthenics training in order to be able to carry out further studies to determine which plans have the best performance. To generate the information, the application allows registered users to use the tool to enter their routines, either weekly or more in monthly detail, register their personal bests and compare the results obtained.

Video link mode of use: 
***

## Table of contents
1. [Distinctiveness and Complexity](#Distinctiveness-and-Complexity)
2. [Contents](#Contents)
3. [How to run](#How-to-run)
4. [Aditional information](#Aditional-information)
***
## Distinctiveness and Complexity

I believe my project meets the distinctiveness and complexity requirements for the following reasons:

1. Comply with responsible design using Bootstrap
2. Includes jquery, specifically it is used in conjunction with Bootstrap to generate the accordion with the exercises.
3. One of the difficult parts was defining how the information would be stored, which was determined to be through models, specifically to resolve the issue of the muscles involved in each exercise, the days of the week and storage of exercise results tracking.
4. Includes authentication and user permissions, where only the admin can directly modify any model, currently from the Django admin page.
5. Use of APIs through fetch that speed up the loading of information to the web page and manipulation of the DOM to avoid reloading the page.
6. Use of window handles that allow going back to the previous state of the web page without making a request to the server.
***
## Contents

### APP: Routine

The Routine app contains the following files:

### Models:

#### Essential:
The information of these models must be created before the launch of the application. Only admins should be able to modify these fields:
1. User: django abstract user (use python manage.py createsuperuser)
2. Day_week: days of the week
3. Muscle: muscles ie dorsal, pectoral, biceps, triceps, and so on...
4. Exercise: calisthenic exercises ie pull up, chin up, squats, and more...

#### Operation:
The information in these models is generated by the user of the application.
1. Box_exercise: container model of the exercise so that each user determines if he wants to include said exercise, the number of series and repetitions
2. Plan: contains all the box_exercises of each user in unique plan
3. Tracker: 

### Views:
Simulate the closest thing to a single page application. 

#### Render:
It has the index, login, logout, register and others view. The latter allows you to see the results of other users.
Important: when a user creates an account a plan object is generated to that user automatically.

#### API:
1. menu_exercise: returns a json object with all the existing data of the exercise objects
2. add_exercise: receives form information and creates a box_exercise object containing the user-selected exercise, sets, reps, and days. Add this to the plan objects of the request user.
3. edit_exercise: receives information from a form to edit the box_exercises selected by the user.
4. remove_exercise: removes and deletes the box_exercise object from the plan object requested by the user
5. info_exercise: returns the information of the box_exercise object specified by the user
6. load_plan: returns all the routine (plan, all box_exercises and tracker objects) information for the specified user. If not specified, it is assumed that it is the information of the user requesting the information
7. upload_track: adds results information (sets and reps performed) to the user-specified exercise. Create a tracker object and add it to the corresponding box_exercise object. Save the date on which the new tracker object was generated
8. users_list: returns a json object with all existing users except the user requesting the information

### Templates:
1. layout.html
2. index.html
3. login.html
4. register.html
5. others.html

### Static:

#### CSS
1. styles.css

#### Javascript:
1. javascript.js: Contains functions that change the content of the DOM via buttons. It uses JQuery to generate an accordion with existing exercises from the data. Fetch to post and get data. Add history.state to manipulate the url and allow the user to interact with the back button. Each function is commented, with more detail on those that are more difficult to read. The functions contained in the document are listed below.
    1. window.onpopstate: the function is modified to allow going back without reloading the page
    2. load_page: This function is what allows you to modify the DOM to see what the user specifies. The options are: exercises (view of all exercises in data base), my routine (plan object of the current user), my results (view of all user exercise tracking) and others (a list with all users of the application except the requesting user). Uses the id of the buttons to determine which page to load
    3. load_plan: This function loads the type of plan that the user wants to work with. The options are weekly and monthly. At the moment only the weekly option is operational. It comes with instructions on how to use each item.
    4. week_info: This function performs a fetch to retrieve the current user's plan information and load it into the weekly calendar
    5. menu_to_add: Generates a pop-up style form that allows the user to enter the information of the series, repetitions and days that he wants to perform the specified exercise. Also used to edit the information of the user-specified box exercise object
    6. close_menu_to_add: Closes the pop-up form and leaves it in its initial state (without information)
    7. add_exercise: Send the request to post the form information. Works for both adding an exercise and editing it (add or edit the box_exercise object with the user-specified exercise object)
    8. remove_exercise: Send the request to the server to remove the exercise from the user's plan. It also removes the box_exercises object in the back-end process.
    9. upload_track: Sends a request to post the information of the form that allows to add the user's performance in the specified exercise. There are two forms that must be filled out to be sent (form to indicate the number of series performed and another to indicate the number of repetitions)

2. others.js: It handles the functions of the others.html page, which are 2
    1. window.onpopstate: the function is modified to allow going back without reloading the page
    2. load_info: It performs a fetch to retrieve the plan information of the user specified by the anchor and alters the dom to display this data in a table format, similar to the my results page.
***
## How to run

### Install requirements
pip install -r requirements.txt

### SetUp

#### Pull Request
If you want you can use the existing database, just make the pull request and then open a console. Create a new user and then run the django build module (python manage.py runserver) and browse the app.

#### From zero
After making the pull request, drop the database (db.sqlite3), perform the migration process (makemigrations then migrate), create a super user and finally run the development server to use the application. To do this:

Open a terminal, go to the projects folder (where is manage.py) an run:
1. python manage.py makemigrations
2. python manage.py migrate
3. python manage.py createsuperuser
4. Use shell or admin page (recomended, run: python manage.py runserver) to add Plan object to the admin user. 
5. Add week day (monday to sunday)
6. Add muscles, ie Dorsal, Pectoral, biceps, triceps, etc...
7. Add exercises, ie Pull up, chin up, squat, etc...

Now you're able to run the app ! 
***

## Aditional information
At this time the project is in the development stage and has not been implemented. For work reasons I have not been able to perform continuous integration not even livetestserver. There are a lot of bugs and impressions in the dev console. Even the project is not finished yet, but the push is being carried out because I consider that it meets the requirements to be approved.
There are some known bugs that I haven't been able to fix yet:

1. When the client goes back with the browser button and the current page is others.html it is not always returned to the previous state. Sometimes it loads the index from the beginning, other times it loads the previous page (ie index when the others button is pressed)
2. If the client presses the "buttons" (they are actually anchor) login or register, and then presses any other button such as the one that CaliRoad says that it is to return to the index, it does not load because the script's functionalities operate with structure declares in the index.html and the current location is either login.html or register.html
3. If an exercise is loaded without a video and/or without an image, when loading the exercise section it throws the 404 error. It does not affect the functionality, so I have not yet paid attention to correcting it
4. It is assumed that if a user modifies an exercise of his routine without indicating any day, it should be eliminated when calling the corresponding function. However, this occurs with an error.
5. There is a bug in the results section when the form is submitted with the reps column button. If it is valid, the information is sent and the new tracking of the exercise results is generated, but the value of the reps is copied to the series. For now, this error can be avoided by submitting the form with the button in the series column.
6. There is a bug when adding more than one exercise without refreshing the page. This causes the request to add the new exercise to be sent, but an entry for the old exercise is generated with the new values.
7. There is a bug when you want to remove more than one exercise from the routine without refreshing the page from the browser. If you perform the action to delete a second exercise, a 500 error is generated because a signal with the id of the previous exercise is sent. This along with the previous error are caused by the same thing but the problem is still not solved.


There must be errors associated with accidentally deleting information from the starting configuration, among others, as well as some vulnerabilities that have not been covered or that simply happened to me. I would be grateful if they could be indicated. Any constructive criticism, recommendation or contribution is welcome.

I'm Bryan Alburquenque, best regards
***